<% layout("/layouts/boilerplate") %>
<link rel="stylesheet" href="/css/index.css" />

<div class="listings-page">
  <div class="container my-4">
    <!-- Enhanced Header Section -->
    <div class="page-header text-center mb-5">
      <% if (searchTerm && searchTerm.trim() !== "") { %>
      <div class="search-results-header">
        <div class="search-icon mb-3">
          <i class="fas fa-search"></i>
        </div>
        <h2 class="display-6 fw-bold gradient-text mb-2">Search Results</h2>
        <p class="lead text-muted">
          Found listings for "<span class="search-term"><%= searchTerm %></span
          >"
        </p>
      </div>
      <% } else { %>
      <div class="all-listings-header">
        <div class="listings-icon mb-3">
          <i class="fas fa-home"></i>
        </div>
        <h2 class="display-6 fw-bold gradient-text mb-2">Discover Places</h2>
        <p class="lead text-muted">
          Find your perfect stay from our curated collection
        </p>
      </div>
      <% } %>
    </div>

    <!-- Enhanced AI Recommendation Section -->
    <div class="ai-section mb-5">
      <div class="ai-recommendation-card">
        <div class="ai-icon">
          <i class="fas fa-brain"></i>
        </div>
        <div class="ai-content">
          <h5 class="ai-title mb-2">Personalized for You</h5>
          <p class="ai-description mb-3">
            Let our AI find the perfect stays based on your preferences
          </p>
          <button id="ai-recommend-btn" class="btn ai-btn">
            <span class="btn-content">
              <i class="fas fa-magic me-2"></i>Get AI Recommendations
            </span>
            <span class="btn-loader">
              <i class="fas fa-spinner fa-spin"></i>
            </span>
          </button>
        </div>
        <div class="ai-glow"></div>
      </div>
    </div>

    <!-- Loading Spinner (Hidden by default) -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p class="loading-text">Finding perfect matches...</p>
      </div>
    </div>

    <!-- Empty State -->
    <% if (allListings.length === 0) { %>
    <div class="empty-listings-state">
      <div class="empty-icon">
        <i class="fas fa-home"></i>
      </div>
      <h4 class="fw-bold mb-3">No listings found</h4>
      <p class="text-muted mb-4">
        <% if (searchTerm && searchTerm.trim() !== "") { %> Try adjusting your
        search terms or browse all available properties. <% } else { %> Be the
        first to add a property to our platform! <% } %>
      </p>
      <a href="/listings/new" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>Add First Listing
      </a>
    </div>
    <% } else { %>

    <!-- Results Counter -->
    <div class="results-counter mb-4">
      <div class="counter-badge">
        <i class="fas fa-list me-2"></i>
        <span><%= allListings.length %></span>
        <%= allListings.length === 1 ? 'property' : 'properties' %> available
      </div>
    </div>

    <!-- Enhanced Listings Grid -->
    <div
      class="listings-grid row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-4 g-4"
    >
      <% allListings.forEach(function(listing, index) { %>
      <div
        class="col listing-item"
        data-listing-id="<%= listing._id %>"
        style="animation-delay: <%= index * 50 %>ms"
      >
        <div class="listing-card h-100">
          <a href="/listings/<%= listing._id %>" class="listing-link">
            <div class="image-container">
              <img
                src="<%= listing.image.url %>"
                class="listing-image"
                alt="<%= listing.title %>"
                loading="lazy"
              />
              <div class="image-overlay">
                <div class="overlay-content">
                  <i class="fas fa-eye"></i>
                  <span>View Details</span>
                </div>
              </div>
              <div class="price-badge">$<%= listing.price %></div>
            </div>
          </a>

          <div class="card-content">
            <div class="listing-info">
              <h5 class="listing-title"><%= listing.title %></h5>
              <div class="listing-meta">
                <div class="price-info">
                  <span class="price">$<%= listing.price %></span>
                  <span class="period">/ night</span>
                </div>
                <div class="rating-placeholder">
                  <i class="fas fa-star"></i>
                  <span>New</span>
                </div>
              </div>
            </div>

            <div class="listing-actions">
              <button
                class="action-btn favorite-btn"
                onclick="toggleFavorite(this, '<%= listing._id %>')"
              >
                <i class="far fa-heart"></i>
              </button>
              <button
                class="action-btn share-btn"
                onclick="shareListing('<%= listing._id %>')"
              >
                <i class="fas fa-share-alt"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <% }); %>
    </div>
    <% } %>
  </div>
</div>
<script src="/js/index.js"></script>
