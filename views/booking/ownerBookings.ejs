<% layout("/layouts/boilerplate") %>

<!-- Enhanced Pending Bookings Page -->
<div class="bookings-container">
  <!-- Animated Header -->
  <div class="header-section text-center mb-5">
    <div class="header-icon-wrapper">
      <i class="fas fa-calendar-check header-icon"></i>
    </div>
    <h2 class="display-5 fw-bold gradient-text mb-3">Pending Bookings</h2>
    <p class="lead text-muted mb-4">
      Manage your property reservations with ease
    </p>
    <% if (bookings.length > 0) { %>
    <div class="stats-badge">
      <i class="fas fa-clock me-2"></i>
      <span class="pending-count"><%= bookings.length %></span>
      <%= bookings.length === 1 ? 'booking' : 'bookings' %> waiting
    </div>
    <% } %>
  </div>

  <!-- Empty State -->
  <% if (bookings.length === 0) { %>
  <div class="empty-state-wrapper">
    <div class="empty-state-card">
      <div class="empty-icon">
        <i class="fas fa-calendar-alt"></i>
      </div>
      <h4 class="fw-bold mb-3">All caught up!</h4>
      <p class="text-muted mb-0">
        No pending bookings at the moment. New requests will appear here.
      </p>
    </div>
  </div>
  <% } else { %>

  <!-- Bookings Grid -->
  <div class="bookings-grid row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
    <% bookings.forEach((booking, index) => { %>
    <div
      class="col booking-item"
      data-booking-id="<%= booking._id %>"
      style="animation-delay: <%= index * 100 %>ms"
    >
      <div class="booking-card h-100">
        <!-- Status Indicator -->
        <div class="status-indicator <%= booking.status %>"></div>

        <div class="card-body p-4">
          <!-- Listing Header -->
          <div class="listing-header mb-4">
            <div class="listing-icon">
              <i class="fa-solid fa-house"></i>
            </div>
            <div class="listing-info">
              <h5 class="listing-title mb-1"><%= booking.listing.title %></h5>
              <small class="text-muted">Property Listing</small>
            </div>
          </div>

          <!-- Booking Details -->
          <div class="booking-details">
            <div class="detail-row">
              <div class="detail-icon">
                <i class="fa-solid fa-user-circle"></i>
              </div>
              <div class="detail-content">
                <span class="detail-label">Guest</span>
                <span class="detail-value"><%= booking.user.username %></span>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon">
                <i class="fa-solid fa-calendar-plus"></i>
              </div>
              <div class="detail-content">
                <span class="detail-label">Check-in</span>
                <span class="detail-value"
                  ><%= booking.checkin.toDateString() %></span
                >
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-icon">
                <i class="fa-solid fa-calendar-minus"></i>
              </div>
              <div class="detail-content">
                <span class="detail-label">Check-out</span>
                <span class="detail-value"
                  ><%= booking.checkout.toDateString() %></span
                >
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="booking-actions mt-4">
            <form
              action="/bookings/<%= booking._id %>/accept"
              method="POST"
              class="action-form"
            >
              <button
                type="submit"
                class="btn btn-accept"
                onclick="handleBookingAction(event, 'accept')"
              >
                <span class="btn-content">
                  <i class="fa-solid fa-check me-2"></i>Accept
                </span>
                <span class="btn-loader">
                  <i class="fas fa-spinner fa-spin"></i>
                </span>
              </button>
            </form>
            <form
              action="/bookings/<%= booking._id %>/reject"
              method="POST"
              class="action-form"
            >
              <button
                type="submit"
                class="btn btn-reject"
                onclick="handleBookingAction(event, 'reject')"
              >
                <span class="btn-content">
                  <i class="fa-solid fa-xmark me-2"></i>Reject
                </span>
                <span class="btn-loader">
                  <i class="fas fa-spinner fa-spin"></i>
                </span>
              </button>
            </form>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="card-footer">
          <div class="d-flex justify-content-between align-items-center">
            <small class="text-muted footer-time">
              <i class="fa-regular fa-clock me-1"></i>
              <%= booking.createdAt.toDateString() %>
            </small>
            <span class="status-badge <%= booking.status %>">
              <i
                class="fas fa-<%= booking.status === 'pending' ? 'hourglass-half' : booking.status === 'accepted' ? 'check-circle' : 'times-circle' %> me-1"
              ></i>
              <%= booking.status.charAt(0).toUpperCase() +
              booking.status.slice(1) %>
            </span>
          </div>
        </div>
      </div>
    </div>
    <% }); %>
  </div>
  <% } %>
</div>
